# Load libraries
library(data.table)
library(dplyr)
library(ggplot2)
library(tidyverse)

library(plotly)


#Load the data

matches <- fread("matches_info_1516.csv")
dataco <- fread("dataco_all_events_1516_fitprob.csv")
events <- fread("all_events_1516_renormalized.csv")
statsr <- fread("stats_minute_1516_renormalized.csv")
stats <- fread("stats_minute_1516.csv")

#1 Prepare the data. For every minute of the match we want 1) goal home or goal away in that minute? 2) state of the match (current result and players on  the field for both teams). 
#point of view of home: + means home team is winning + players means home team has more players on the field
all(statsr$home_goal_now %in% c(0, 1)) && all(statsr$away_goal_now %in% c(0, 1))

statsr$score_state <- statsr$home_goals - statsr$away_goals
statsr$numbers_players_state <- statsr$red_cards_away - statsr$red_cards_home

state_data <- statsr[, c("match_id", 
                     "minute", 
                     "home_goal_now", 
                     "away_goal_now", 
                     "score_state", 
                     "numbers_players_state")]

