library(data.table)
library(jsonlite)

all_events_v2 <- fread("all_events_v2.csv")
cleaned_matches_info <- fread("cleaned_matches_info.csv")

########################################################################################################
#1) Sanity check. We start by checking that all matches from all_events_v2 appear in cleaned_matches_info
event_match_ids <- unique(all_events_v2$match_id)
info_match_ids <- cleaned_matches_info$match_id

# 2. Check 1: Are the match_ids in cleaned_matches_info unique?
# Your creation script should ensure this, but it's good practice to verify.
if (nrow(cleaned_matches_info) == length(unique(info_match_ids))) {
  cat("✅ SUCCESS: All match_id's in 'cleaned_matches_info' are unique.\n")
} else {
  cat("❌ FAILURE: There are duplicate match_id's in 'cleaned_matches_info'.\n")
}
# 3. Check 2: Do all event match_ids appear in the info table?
# We use setdiff() to find any IDs that are in the events but NOT in the info table.
missing_ids <- setdiff(event_match_ids, info_match_ids)

if (length(missing_ids) == 0) {
  cat("✅ SUCCESS: All match_id's from 'all_events_v2' are present in 'cleaned_matches_info'.\n")
} else {
  cat("❌ FAILURE: The following match_id's from 'all_events_v2' are MISSING from 'cleaned_matches_info':\n")
  print(missing_ids)
}

# 4 Filter 'cleaned_matches_info' to keep only the rows with the match_ids from all_events_v2


matches_info_all_events <- cleaned_matches_info[match_id %in% event_match_ids]


##########################################################################################
############################## La Liga #############################################
##########################################################################################

laliga_events <- matches_info_all_events[matches_info_all_events$competition.competition_name == "La Liga", ]

## 1. Find all "laliga" CSV files in the folder
file_paths_laliga <- list.files(
  path = "football_data_co",
  pattern = "^laliga_.*\\.csv$",
  full.names = TRUE
)

## 2. Read and combine all files (with the final fix)
# Using fill = Inf is the most robust way to read inconsistent files.
laliga_dataco <- rbindlist(
  lapply(file_paths_laliga, fread, fill = Inf), # <-- The final fix is here
  fill = TRUE,
  idcol = "source_file"
)


##########################################################################################
############################## Serie A#############################################
##########################################################################################
seriea_events <- matches_info_all_events[matches_info_all_events$competition.competition_name == "Serie A", ]


## 1. Find all "seriea" CSV files in the folder
file_paths_seriea <- list.files(
  path = "football_data_co",
  pattern = "^seriea_.*\\.csv$",
  full.names = TRUE
)

## 2. Read and combine all files (with the final fix)
# Using fill = Inf is the most robust way to read inconsistent files.
seriea_dataco <- rbindlist(
  lapply(file_paths_seriea, fread, fill = Inf), # <-- The final fix is here
  fill = TRUE,
  idcol = "source_file"
)


##########################################################################################
############################## Premieer LEAGUE #############################################
##########################################################################################

premier_events <- matches_info_all_events[matches_info_all_events$competition.competition_name == "Premier League", ]

## 1. Find all "premier" CSV files in the folder
file_paths_premier <- list.files(
  path = "football_data_co",
  pattern = "^premier_.*\\.csv$",
  full.names = TRUE
)

## 2. Read and combine all files (with the final fix)
# Using fill = Inf is the most robust way to read inconsistent files.
premier_dataco <- rbindlist(
  lapply(file_paths_premier, fread, fill = Inf), # <-- The final fix is here
  fill = TRUE,
  idcol = "source_file"
)




##########################################################################################
############################## Ligue 1 #############################################
##########################################################################################

ligue1_events <- matches_info_all_events[matches_info_all_events$competition.competition_name == "Ligue 1", ]





## 1. Find all "ligue1" CSV files in the folder
file_paths_ligue1 <- list.files(
  path = "football_data_co",
  pattern = "^ligue1_.*\\.csv$",
  full.names = TRUE
)

## 2. Read and combine all files (with the final fix)
# Using fill = Inf is the most robust way to read inconsistent files.
ligue1_dataco <- rbindlist(
  lapply(file_paths_ligue1, fread, fill = Inf), # <-- The final fix is here
  fill = TRUE,
  idcol = "source_file"
)

##########################################################################################
############################## Bundesliga #############################################
##########################################################################################

bundesliga_events <- matches_info_all_events[matches_info_all_events$competition.competition_name == "1. Bundesliga", ]
## 1. Find all "bundesliga" CSV files in the folder
file_paths_bundesliga <- list.files(
  path = "football_data_co",
  pattern = "^bundesliga_.*\\.csv$",
  full.names = TRUE
)

## 2. Read and combine all files (with the final fix)
# Using fill = Inf is the most robust way to read inconsistent files.
bundesliga_dataco <- rbindlist(
  lapply(file_paths_bundesliga, fread, fill = Inf), # <-- The final fix is here
  fill = TRUE,
  idcol = "source_file"
)
